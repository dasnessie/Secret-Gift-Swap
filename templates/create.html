<!doctype html>
{% extends "base.html" %}

{% block content %}
    <h2>{{ _('Create new gift exchange') }}</h2>
    <p>{{ _('There is no gift exchange with this name yet. You can create a new gift exchange here.') }}</p>

    {% if errorMessage %}
        <p class="exchange-creation-error"> {{ errorMessage }} </p>
    {% endif %}

    <form id="participant-form" action="/{{ exchangeName }}/create" method="POST">
        <fieldset id="participants" aria-label="{{ _('Add participants') }}"
            {% if existingFormData and existingFormData.getlist("giver") %}
                disabled
            {% endif %}
        >
            <legend>{{ _('Participants') }}</legend>
            <ul id="participant-list">
                {% if existingFormData and existingFormData.getlist("participant") %}
                    {% for participant in existingFormData.getlist("participant") %}
                        <li>
                            <input type="text" name="participant" class="participant" value="{{ participant }}"/>
                            <button type="button" class="delete-participant">{{ _('Delete') }}</button>
                        </li>
                    {% endfor %}
                {% else %}
                    <li>
                        <input type="text" name="participant" class="participant"/>
                        <button type="button" class="delete-participant secondary-button">{{ _('Delete') }}</button>
                    </li>
                {% endif %}
            </ul>
            <button type="button" id="add-participant" class="secondary-button">{{ _('Add participant') }}</button>
        </fieldset>
        <fieldset id="constraints" 
            {% if not (existingFormData and existingFormData.getlist("giver") and existingFormData.getlist("giftee") and existingFormData.getlist("probability-level")) %}
            hidden disabled
            {% endif %}
        >
            <legend>{{ _('Constraints') }}</legend>
            <ul id="constraint-list">
                <li hidden>
                    <span class="sr-only from-label">{{ _('From') }}</span>
                    <select class="giver" name="giver">
                        <option value="" selected>{{ _('Participant…') }}</option>
                        {% if existingFormData and existingFormData.getlist("participant") %}
                            {% for participant in existingFormData.getlist("participant") %}
                                <option value="{{ participant }}">{{ participant }}</option>
                            {% endfor %}
                        {% endif %}
                    </select>
                    <span class="arrow-right" aria-label="{{ _('to') }}">→</span>
                    <span class="arrow-both" aria-label="{{ _('and') }}" hidden>↔</span>
                    <select class="giftee" name="giftee">
                        <option value="" selected>{{ _('Participant…') }}</option>
                        {% if existingFormData and existingFormData.getlist("participant") %}
                            {% for participant in existingFormData.getlist("participant") %}
                                <option value="{{ participant }}">{{ participant }}</option>
                            {% endfor %}
                        {% endif %}
                    </select>
                    <select class="probability-level" name="probability-level">
                        <option value="" selected>{{ _('Constraint level…') }}</option>
                        <option value="never">{{ _('Never match') }}</option>
                        <option value="1_past_exchange">{{ _('Did match last exchange') }}</option>
                        <option value="2_past_exchange">{{ _('Did match two exchanges ago') }}</option>
                        <option value="3_past_exchange">{{ _('Did match three exchanges ago') }}</option>
                    </select>
                    <button type="button" class="delete-constraint secondary-button">{{ _('Delete') }}</button>
                </li>
                {% if existingFormData and existingFormData.getlist("giver") and existingFormData.getlist("giftee") and existingFormData.getlist("probability-level") %}
                    {% for giver, giftee, probability in zip(existingFormData.getlist("giver")[1:], existingFormData.getlist("giftee")[1:], existingFormData.getlist("probability-level")[1:])%}
                        <li>
                            <span class="sr-only from-label">{{ _('From') }}</span>
                            <select required class="giver" name="giver">
                                <option value="" 
                                    {% if not giver %}
                                        selected
                                    {% endif%}
                                >{{ _('Participant…') }}</option>
                                {% if existingFormData.getlist("participant") %}
                                    {% for participant in existingFormData.getlist("participant") %}
                                        <option value="{{ participant }}"
                                            {% if participant == giver %}
                                                selected
                                            {% endif %}
                                        >{{ participant }}</option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                            <span class="arrow-right" aria-label="{{ _('to') }}"
                            {% if probability == 'never' %}
                                hidden
                            {% endif %}
                            >→</span>
                            <span class="arrow-both" aria-label="{{ _('and') }}"
                            {% if probability != 'never' %} 
                                hidden
                            {% endif %}
                            >↔</span>
                            <select required class="giftee" name="giftee">
                                <option value="" 
                                    {% if not giftee %}
                                        selected
                                    {% endif%}
                                >{{ _('Participant…') }}</option>
                                {% if existingFormData.getlist("participant") %}
                                    {% for participant in existingFormData.getlist("participant") %}
                                        <option value="{{ participant }}"
                                            {% if participant == giftee %}
                                                selected
                                            {% endif %}
                                        >{{ participant }}</option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                            <select required class="probability-level" name="probability-level">
                                <option value="" 
                                    {% if probability == "" %}
                                        selected
                                    {% endif %}
                                >{{ _('Constraint level…') }}</option>
                                <option value="never"
                                    {% if probability == "never" %}
                                        selected
                                    {% endif %}
                                >{{ _('Never match') }}</option>
                                <option value="1_past_exchange"
                                    {% if probability == "1_past_exchange" %}
                                        selected
                                    {% endif %}
                                >{{ _('Did match last exchange') }}</option>
                                <option value="2_past_exchange"
                                    {% if probability == "2_past_exchange" %}
                                        selected
                                    {% endif %}
                                >{{ _('Did match two exchanges ago') }}</option>
                                <option value="3_past_exchange"
                                {% if probability == "3_past_exchange" %}
                                    selected
                                {% endif %}
                                >{{ _('Did match three exchanges ago') }}</option>
                            </select>
                            <button type="button" class="delete-constraint secondary-button">{{ _('Delete') }}</button>
                        </li>
                    {% endfor %}
                {% endif %}
            </ul>
            <button type="button" id="add-constraint" class="secondary-button">{{ _('Add constraint') }}</button>
        </fieldset>
        <div id="submit-buttons">
            {% if existingFormData and existingFormData.getlist("giver") and existingFormData.getlist("giftee") and existingFormData.getlist("probability-level") %}
                <button type="button" id="next-button" hidden>{{ _('Next') }}</button>
                <button type="submit" id="generate-button">{{ _('Generate matching!') }}</button>
            {% else %}
                <button type="button" id="next-button">{{ _('Next') }}</button>
                <button type="submit" id="generate-button" hidden>{{ _('Generate matching!') }}</button>
            {% endif %}
        </div>
    </form>

    <script src="/static/create.js"></script>
{% endblock %}